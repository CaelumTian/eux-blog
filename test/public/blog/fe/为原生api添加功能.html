<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Picidae </title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
<div id="root">
    <div class="main" data-reactroot="" data-reactid="1" data-react-checksum="-656027064"><header class="clearfix eux-header" data-reactid="2"><div class="eux-header-top" data-reactid="3"><a href="javascript:void(0);" class="eux-portable-menu" data-reactid="4"></a><nav class="menu-primary-container" data-reactid="5"><ul id="menu-primary" class="menu" data-reactid="6"><li id="menu-item-25" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25" data-reactid="7"><a href="/" data-reactid="8">HOME</a></li><li id="menu-item-45" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-ancestor current-menu-parent menu-item-has-children menu-item-45" data-reactid="9"><a href="/" data-reactid="10">BLOG</a><ul class="sub-menu" data-reactid="11"><li id="menu-item-63" class="menu-item menu-item-type-taxonomy menu-item-object-category current-menu-item menu-item-63" data-reactid="12"><a href="/ue" data-reactid="13">交互</a></li><li id="menu-item-67" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-67" data-reactid="14"><a href="/ui" data-reactid="15">视觉</a></li><li id="menu-item-64" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-64" data-reactid="16"><a href="/fe" data-reactid="17">前端</a></li><li id="menu-item-62" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-62" data-reactid="18"><a href="/team" data-reactid="19">团队</a></li></ul></li><li id="menu-item-46" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-46" data-reactid="20"><a href="/tools" data-reactid="21">TOOLS</a></li><li id="menu-item-112" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-112" data-reactid="22"><a href="/works" data-reactid="23">WORKS</a></li><li id="menu-item-138" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-138" data-reactid="24"><a href="/jobs" data-reactid="25">JOBS</a></li><li id="menu-item-50" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-50" data-reactid="26"><a href="/about-us" data-reactid="27">ABOUT US</a></li></ul></nav></div></header><div class="eux-singular clearfix" data-reactid="28"><div class="container-singular clearfix" data-reactid="29"><nav class="menu-categories-container" data-reactid="30"><ul id="menu-categories" class="menu" data-reactid="31"><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="32"><span data-reactid="33"><a href="/" data-reactid="34">全部</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="35"><span data-reactid="36"><a href="/ue" data-reactid="37">交互</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="38"><span data-reactid="39"><a href="/ui" data-reactid="40">视觉</a></span></li><li class="current-menu-item menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="41"><span data-reactid="42"><a href="/fe" data-reactid="43">前端</a></span></li><li class="menu-item menu-item-type-custom menu-item-object-custom current_page_item menu-item-55" data-reactid="44"><span data-reactid="45"><a href="/team" data-reactid="46">团队</a></span></li></ul></nav><div class="inner clearfix" data-reactid="47"><div class="article-meta" data-reactid="48"><h1 class="title" data-reactid="49">为原生API添加功能</h1><div class="eux-page-detail" data-reactid="50"><span data-reactid="51"><em data-reactid="52">by.</em><!-- react-text: 53 -->苏 迪<!-- /react-text --></span><span data-reactid="54">2017-6-19</span></div></div><article data-reactid="55"><h4 id="为原生api添加功能，即继承原生api并进行扩展" data-reactid="56"><a href="#%E4%B8%BA%E5%8E%9F%E7%94%9Fapi%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%8D%B3%E7%BB%A7%E6%89%BF%E5%8E%9F%E7%94%9Fapi%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%B1%95" aria-hidden="true" data-reactid="57"><span class="icon icon-link" data-reactid="58"></span></a><!-- react-text: 59 -->为原生API添加功能，即继承原生API并进行扩展<!-- /react-text --></h4><!-- react-text: 60 -->
<!-- /react-text --><p data-reactid="61"><!-- react-text: 62 -->这篇文章来源于一个需求：<!-- /react-text --><strong data-reactid="63">如何统计ajax请求从发起到成功返回所耗费的时间</strong><!-- react-text: 64 -->？ 如果在业务中每个请求的发起和结束时进行打点，计算差值的话，那么工作量将非常巨大，如果要求每个项目封装一个通用方法的话，对于我们这种有好几百个项目的部门来说也同样是不可能的，那么就需要对XMLHttpRequest本身进行功能扩展.  <!-- /react-text --></p><!-- react-text: 65 -->
<!-- /react-text --><h4 id="实现原理解析" data-reactid="66"><a href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90" aria-hidden="true" data-reactid="67"><span class="icon icon-link" data-reactid="68"></span></a><strong data-reactid="69">实现原理解析</strong></h4><!-- react-text: 70 -->
<!-- /react-text --><p data-reactid="71">不改变this指向的情况，比如下面这个例子，this指向始终是window,那么我们无需对this的指向做任何更改。  </p><!-- react-text: 72 -->
<!-- /react-text --><pre data-reactid="73"><code data-query="{}" data-lang="data-lang" data-reactid="74">    //原函数
    function a (v) {
        console.log(v)
    }

    //创建一个变量b, 指向原函数，以保留原函数的功能
    let b = a;

    //覆写原函数
    a = function (v) {
        console.log(v + 1); //执行新增功能
        b(v);      //执行原函数功能
    }

    a(1); // 2 1
</code></pre><!-- react-text: 75 -->
<!-- /react-text --><p data-reactid="76">需要改变this指向  </p><!-- react-text: 77 -->
<!-- /react-text --><pre data-reactid="78"><code data-query="{}" data-lang="data-lang" data-reactid="79">    //原函数
    let obj = {
        a: function(v) {
            //这里this指向obj
            this.v = v
            console.log(this.v);
        }
    }

    //创建一个变量b, 指针指向原函数, 但是对于b来说， this === window
    let b = obj.a;

    //覆写原函数
    obj.a = function (v) {
        let args = [].slice.call(arguments);
        b.apply(this, args);      //原函数功能,需要将this重新指向obj
        console.log(this.v + 1); //新增功能
    }

    obj.a(1); // 1 2
</code></pre><!-- react-text: 80 -->
<!-- /react-text --><p data-reactid="81">实例1：在alert的时候console.log打印alert的值  </p><!-- react-text: 82 -->
<!-- /react-text --><pre data-reactid="83"><code data-query="{}" data-lang="data-lang" data-reactid="84">(function () {
    let a = alert;

    alert = function (v) {
        console.log(v);
        a(v);
    }

    alert(1); // 控制台输出1，弹窗1
})();
</code></pre><!-- react-text: 85 -->
<!-- /react-text --><p data-reactid="86">实例2：在console.log的同时进行alert  </p><!-- react-text: 87 -->
<!-- /react-text --><pre data-reactid="88"><code data-query="{}" data-lang="data-lang" data-reactid="89">(function () {
    let a = console.log;

    console.log = function () {
        //将arguments转成数组，如果需要对参数做push、pop等操作的话需要转换，否则不需要
        var args = [].slice.call(arguments);
        a.apply(this, args); //这里就不能直接使用a(...args)
        alert(args[0])
    }

    console.log(1); // 控制台输出1，弹窗1
})();
</code></pre><!-- react-text: 90 -->
<!-- /react-text --><h4 id="方法总结" data-reactid="91"><a href="#%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93" aria-hidden="true" data-reactid="92"><span class="icon icon-link" data-reactid="93"></span></a><!-- react-text: 94 -->方法总结<!-- /react-text --></h4><!-- react-text: 95 -->
<!-- /react-text --><p data-reactid="96">step1：  </p><!-- react-text: 97 -->
<!-- /react-text --><p data-reactid="98"><!-- react-text: 99 -->先用一个变量，如<!-- /react-text --><code data-reactid="100">a</code><!-- react-text: 101 -->，指向原方法。  <!-- /react-text --></p><!-- react-text: 102 -->
<!-- /react-text --><pre data-reactid="103"><code data-query="{}" data-lang="data-lang" data-reactid="104">let a = console.log;
</code></pre><!-- react-text: 105 -->
<!-- /react-text --><p data-reactid="106">step2：  </p><!-- react-text: 107 -->
<!-- /react-text --><p data-reactid="108"><!-- react-text: 109 -->新写一个函数覆盖原方法，增加你想要的扩展功能，并在其中调用step1中的<!-- /react-text --><code data-reactid="110">a</code><!-- react-text: 111 -->，并通过<!-- /react-text --><code data-reactid="112">apply</code><!-- react-text: 113 -->方法保证<!-- /react-text --><code data-reactid="114">a</code><!-- react-text: 115 -->执行的时候有正确的this指向和参数传递，保证原方法的正常使用。  <!-- /react-text --></p><!-- react-text: 116 -->
<!-- /react-text --><pre data-reactid="117"><code data-query="{}" data-lang="data-lang" data-reactid="118">console.log = function () {
    var args = [].slice.call(arguments);
    args.push(1); //如果对入参有修改，需要将arguments转换为Array.
    a.apply(this, args); //这里就不能直接使用a(...args)
    alert(args[0]);
}
</code></pre><!-- react-text: 119 -->
<!-- /react-text --><p data-reactid="120">虽然在一些情况下this指向不发生改变，无需使用apply，但是使用apply也可以得到正确的结果，从参数扩展、方便记忆的角度话可以统一成同一种模式。  </p><!-- react-text: 121 -->
<!-- /react-text --><p data-reactid="122"><strong data-reactid="123">通过apply与call实现继承的方式</strong><!-- react-text: 124 -->  <!-- /react-text --></p><!-- react-text: 125 -->
<!-- /react-text --><ul data-reactid="126"><!-- react-text: 127 -->
<!-- /react-text --><li data-reactid="128"><!-- react-text: 129 -->apply() 方法在<!-- /react-text --><strong data-reactid="130">指定 this 值和参数</strong><!-- react-text: 131 -->（参数以数组或类数组对象的形式存在）的情况下<!-- /react-text --><strong data-reactid="132">调用</strong><!-- react-text: 133 -->某个函数.<!-- /react-text --></li><!-- react-text: 134 -->
<!-- /react-text --><li data-reactid="135"><!-- react-text: 136 -->call() 方法在<!-- /react-text --><strong data-reactid="137">指定this值和若干个指定的参数值</strong><!-- react-text: 138 -->的前提下<!-- /react-text --><strong data-reactid="139">调用</strong><!-- react-text: 140 -->某个函数.<!-- /react-text --></li><!-- react-text: 141 -->
<!-- /react-text --><li data-reactid="142"><strong data-reactid="143">注意</strong><!-- react-text: 144 -->： apply() 方法接受的是<!-- /react-text --><strong data-reactid="145">一个包含多个参数的数组</strong><!-- react-text: 146 -->，call() 方法接受的是<!-- /react-text --><strong data-reactid="147">若干个参数的列表</strong><!-- react-text: 148 -->.<!-- /react-text --></li><!-- react-text: 149 -->
<!-- /react-text --></ul><!-- react-text: 150 -->
<!-- /react-text --><pre data-reactid="151"><code data-query="{}" data-lang="data-lang" data-reactid="152">   fun.apply(thisArg, [argsArray])
   fun.call(thisArg, ...argsArray)
</code></pre><!-- react-text: 153 -->
<!-- /react-text --><h4 id="参考资料" data-reactid="154"><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" aria-hidden="true" data-reactid="155"><span class="icon icon-link" data-reactid="156"></span></a><!-- react-text: 157 -->参考资料<!-- /react-text --></h4><!-- react-text: 158 -->
<!-- /react-text --><ul data-reactid="159"><!-- react-text: 160 -->
<!-- /react-text --><li data-reactid="161"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply" data-reactid="162">MDN Function.prototype.apply()</a></li><!-- react-text: 163 -->
<!-- /react-text --><li data-reactid="164"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call" data-reactid="165">MDN Function.prototype.call()</a></li><!-- react-text: 166 -->
<!-- /react-text --></ul><!-- react-text: 167 -->
<!-- /react-text --></article><div data-reactid="168"><div class="valine-comment-container" data-reactid="169"></div></div><nav class="single-bar clearfix" data-reactid="170"><span class="prev" data-reactid="171"><a rel="prev" href="/blog/fe/web开发中常见的乱码" data-reactid="172"><em class="eux-icon eux-icon-page-prev" data-reactid="173"></em><!-- react-text: 174 -->Web开发中常见的“乱码”<!-- /react-text --></a></span><span class="next" data-reactid="175"><a rel="next" href="/blog/fe/浏览器返回的缓存问题" data-reactid="176"><em class="eux-icon eux-icon-page-next" data-reactid="177"></em><!-- react-text: 178 -->浏览器返回的缓存问题<!-- /react-text --></a></span></nav></div></div></div><footer class="footer" data-reactid="179"><div class="eux-footer-area-wrapper container-singular" role="complementary" data-reactid="180"><div class="inner clearfix" data-reactid="181"><aside id="simple-links-2" class="widget sl-links-main" data-reactid="182"><h2 class="widgettitle" data-reactid="183">友情链接</h2><ul class="simple-links-list simple-links-2-list" id="simple-links-2-list" data-reactid="184"><li class="simple-links-item simple-links-widget-item" id="link-379" data-reactid="185"><a href="http://sux.baidu.com" target="_blank" title="百度搜索用户体验中心" data-reactid="186">百度 SUX</a></li><li class="simple-links-item simple-links-widget-item" id="link-362" data-reactid="187"><a href="http://fex.baidu.com/" target="_blank" title="百度 FEX 团队" data-reactid="188">百度 FEX</a></li><li class="simple-links-item simple-links-widget-item" id="link-368" data-reactid="189"><a href="http://efe.baidu.com/" target="_blank" title="百度 EFE 团队" data-reactid="190">百度 EFE</a></li><li class="simple-links-item simple-links-widget-item" id="link-795" data-reactid="191"><a href="https://aotu.io/" target="_blank" title="京东凹凸实验室，面向多终端技术体系，致力于构建沉淀与分享包括但不限于交互、页面制作技巧、前端开发、原生APP开发等方面的专业知识及案例。" data-reactid="192">凹凸实验室</a></li></ul></aside><!-- react-text: 193 -->          <!-- /react-text --></div></div><div class="eux-icp" data-reactid="194"><!-- react-text: 195 -->百度EUX 版权所有 ©百度EUX    All rights reserved. 骄傲地采用 <!-- /react-text --><a target="_blank" href="https://github.com/picidaejs/picidaejs" data-reactid="196">Picidae</a><!-- react-text: 197 -->。<!-- /react-text --></div></footer></div>
</div>
<script src="/PICIDAE_COMMON.js"></script>
<script src="/PICIDAE_ENTRY.js"></script>
</body>
</html>